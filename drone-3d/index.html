<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<title>WebGL Gaussian Splat Viewer</title>
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"
		/>
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta
			name="apple-mobile-web-app-status-bar-style"
			content="black-translucent"
		/>

		<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

		<style>
			body {
				overflow: hidden;
				margin: 0;
				height: 100vh;
				width: 100vw;
				font-family: sans-serif;
				background: black;
    			text-shadow: 0 0 3px black;
			}
			a, body {
				color: white;
			}
			#info {
				z-index: 100;
				position: absolute;
				top: 10px;
				left: 15px;
			}
			h3 {
				margin: 5px 0;
			}
			p {
				margin: 5px 0;
				font-size: small;
			}

			.cube-wrapper {
				transform-style: preserve-3d;
			}

			.cube {
				transform-style: preserve-3d;
				transform: rotateX(45deg) rotateZ(45deg);
				animation: rotation 2s infinite;
			}

			.cube-faces {
				transform-style: preserve-3d;
				height: 80px;
				width: 80px;
				position: relative;
				transform-origin: 0 0;
				transform: translateX(0) translateY(0) translateZ(-40px);
			}

			.cube-face {
				position: absolute;
				inset: 0;
				background: #0017ff;
				border: solid 1px #ffffff;
			}
			.cube-face.top {
				transform: translateZ(80px);
			}
			.cube-face.front {
				transform-origin: 0 50%;
				transform: rotateY(-90deg);
			}
			.cube-face.back {
				transform-origin: 0 50%;
				transform: rotateY(-90deg) translateZ(-80px);
			}
			.cube-face.right {
				transform-origin: 50% 0;
				transform: rotateX(-90deg) translateY(-80px);
			}
			.cube-face.left {
				transform-origin: 50% 0;
				transform: rotateX(-90deg) translateY(-80px) translateZ(80px);
			}

			@keyframes rotation {
				0% {
					transform: rotateX(45deg) rotateY(0) rotateZ(45deg);
					animation-timing-function: cubic-bezier(
						0.17,
						0.84,
						0.44,
						1
					);
				}
				50% {
					transform: rotateX(45deg) rotateY(0) rotateZ(225deg);
					animation-timing-function: cubic-bezier(
						0.76,
						0.05,
						0.86,
						0.06
					);
				}
				100% {
					transform: rotateX(45deg) rotateY(0) rotateZ(405deg);
					animation-timing-function: cubic-bezier(
						0.17,
						0.84,
						0.44,
						1
					);
				}
			}

			.scene,
			#message {
				position: absolute;
				display: flex;
				top: 0;
				right: 0;
				left: 0;
				bottom: 0;
				z-index: 2;
				height: 100%;
				width: 100%;
				align-items: center;
				justify-content: center;
			}
			#message {
				font-weight: bold;
				font-size: large;
				color: red;
				pointer-events: none;
			}

			details {
				font-size: small;

			}

			#progress {
				position: absolute;
				top: 0;
				height: 5px;
				background: blue;
				z-index: 99;
				transition: width 0.1s ease-in-out;
			}

			#quality {
				position: absolute;
				bottom: 10px;
				z-index: 999;
				right: 10px;
			}

			#caminfo {
				position: absolute;
				top: 10px;
				z-index: 999;
				right: 10px;
			}
			#canvas {
				display: block;
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				touch-action: none;
			}

			#instructions {
				background: rgba(0,0,0,0.6);
				white-space: pre-wrap;
				padding: 10px;
				border-radius: 10px;
				font-size: x-small;
			}
			body.nohf .nohf {
				display: none;
			}
			body.nohf #progress, body.nohf .cube-face {
				background: #ff9d0d;
			}
      

      #chatBox {
      position: fixed; /* Or absolute, depending on your requirement */
      bottom: 20px;
      right: 20px;
      width: 300px;
      height: 400px;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      padding: 10px;
      box-sizing: border-box;
    }

    #chatHeader {
      font-weight: bold;
      margin-bottom: 10px;
    }

    #chatContent {
      flex: 1;
      overflow-y: auto;
    }

    #chatInput {
      margin-top: 10px;
      padding: 5px;
      width: calc(100% - 10px); /* Adjust based on padding */
      box-sizing: border-box;
    }

	#title-box {
		font-family: 'Poppins', sans-serif;
	}

	.bold-text {
	font-weight: 700; /* Bold */
	}

	.extra-bold-text {
	font-weight: 800; /* ExtraBold */
	}	

	#fancy-title {
		position: absolute;
		top: 15%; /* Adjust the position as needed */
		left: 50%;
		transform: translateX(-50%);
		font-size: 180px;
		font-weight: bold;
		color: #FFF; 
		text-shadow: 0 0 180px rgba(0,0,0,0.6);
		z-index: 10;
	}


	#fancy-title span {
	background: linear-gradient(to right, rgb(52, 180, 222), green, white);
	-webkit-background-clip: text;
	background-clip: text;
	color: transparent;
	display: inline; /* or 'block' depending on layout needs */
	}

	#subtitle {
		position: absolute;
		top: 40%; /* Adjust the position as needed */
		left: 50%;
		transform: translateX(-50%);
		opacity: 0;
		transition: opacity 1s;
		font-size: 25px;
		font-weight: 300; 
		text-shadow: 0 0 180px rgba(0,0,0,0.6);
		z-index: 10;
	}


		</style>
	</head>
	<body>
		<script>
			if(location.host.includes('hf.space')) document.body.classList.add('nohf');
		</script>

		<div id="progress"></div>

		<div id="message"></div>
		<div class="scene" id="spinner">
			<div class="cube-wrapper">
				<div class="cube">
					<div class="cube-faces">
						<div class="cube-face bottom"></div>
						<div class="cube-face top"></div>
						<div class="cube-face left"></div>
						<div class="cube-face right"></div>
						<div class="cube-face back"></div>
						<div class="cube-face front"></div>
					</div>
				</div>
			</div>
		</div>
		<canvas id="canvas"></canvas>

		<div id="quality">
			<span id="fps"></span>
		</div>
		<div id="caminfo">
			<span id="camid"></span>
		</div>
		<script src="maings.js"></script>

	<div id="title-box">
		<div id="fancy-title"><span>Eco</span>Drone</div>
		<div id="subtitle">Building the Future of Structural Investigation</div>
	</div>

	<script>
		const subtitles = [
		  "Preventing Ecological Hazards, One Drone at a Time",
		  "Gaussian Splat Models for Real Time Risk Assessment",
		  "Agentic VLLM-powered Drone Navigation",
		];
		let currentSubtitleIndex = 0;
	  
		const subtitleElement = document.getElementById('subtitle');
	  
		function updateSubtitle() {
		  subtitleElement.style.opacity = 0;
		  setTimeout(() => {
			currentSubtitleIndex = (currentSubtitleIndex + 1) % subtitles.length;
			subtitleElement.textContent = subtitles[currentSubtitleIndex];
			subtitleElement.style.opacity = 1;
		  }, 500); // Halfway through the interval to match the fade out
		}
	  
		// Initial call to set the first subtitle after 1 second (for the fade-in effect)
		setTimeout(() => {
		  subtitleElement.style.opacity = 1;
		}, 1000);
	  
		setInterval(updateSubtitle, 5000); // Change subtitle every 5 seconds
	  </script>
	  

	  
    <div id="chatBox">
      <div id="chatHeader">Chat</div>
      <div id="chatContent"></div>
      <input type="text" id="chatInput" placeholder="Type a message..." />
    </div>

    <script>
      let chatHistory = [];
      function displayUserMessage(message) {
          var userMessageDiv = document.createElement('div');
          userMessageDiv.textContent = 'You: ' + message;
          userMessageDiv.style.color = 'lightblue';
          document.getElementById('chatContent').appendChild(userMessageDiv);
          scrollToBottom();
          
          // Update chat history
          chatHistory.push({
              role: 'user',
              content: message
          });
      }

      function displayBotResponse(message) {
          var botMessageDiv = document.createElement('div');
          botMessageDiv.textContent = 'Bot: ' + message;
          botMessageDiv.style.color = 'lightgreen';
          document.getElementById('chatContent').appendChild(botMessageDiv);
          scrollToBottom();
          
          // Update chat history
          chatHistory.push({
              role: 'system', // or 'assistant' depending on the API's expected format
              content: message
          });
      }

      function scrollToBottom() {
        var chatContent = document.getElementById('chatContent');
        chatContent.scrollTop = chatContent.scrollHeight;
      }

      async function fetchChatResponse(userMessage) {
          const url = 'https://api.together.xyz/v1/chat/completions';
          //TOGETHER API KEY
          const apiKey = ''; // Replace with your actual API key

          const headers = new Headers({
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${apiKey}`
          });

          // Include chat history in the data object
          const data = {
              model: 'mistralai/Mixtral-8x7B-Instruct-v0.1',
              max_tokens: 1024,
              messages: [...chatHistory, {role: 'user', content: userMessage}],
              "stream_tokens": true
          };

          const options = {
              method: 'POST',
              headers,
              body: JSON.stringify(data)
          };


          const response1 = await fetchEventSource(url, {options,
            onmessage(ev) {
                console.log(ev.data);
            }
          });

          const response = await fetch(url, options);
          const result = await response.json();
          
          // Assuming the API returns a single response message
          return result.choices[0].message.content; // Adjust based on actual API response structure
      }


      document.getElementById('chatInput').addEventListener('keypress', async function(event) {
          if (event.key === 'Enter') {
            event.preventDefault(); // Prevent form submission if your input is in a form

            var message = this.value.trim();
            if (message) {
              displayUserMessage(message);
              console.log("Calling together...")
              try {
                const response = await fetchChatResponse(message);
                displayBotResponse(response);
              } catch (error) {
                console.error('Chat API Error:', error);
                displayBotResponse("Sorry, I can't respond right now.");
              }
              console.log("Called together...")
              this.value = ''; // Clear the input field
            }
          }
        });

    </script>


	</body>
</html>